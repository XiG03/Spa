@model SpaBookingWeb.ViewModels.Client.ReviewPageViewModel
@{
    Layout = "_Layout"; // Sử dụng layout chung của hệ thống
    ViewData["Title"] = "Đánh giá dịch vụ";
}

<style>
    /* Custom scrollbar for better aesthetics */
    ::-webkit-scrollbar {
        width: 8px;
    }
    ::-webkit-scrollbar-track {
        background: #f1f1f1; 
    }
    ::-webkit-scrollbar-thumb {
        background: #e6dbde; 
        border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: #d1c2c5; 
    }
    
    .star-rating:hover .material-symbols-outlined {
        font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 48;
    }
    
    .material-symbols-outlined {
        font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 48;
        transition: font-variation-settings 0.2s ease;
    }

    .material-symbols-outlined.filled {
        font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 48;
    }
    
    /* Logic hover sao bằng CSS */
    .rating-group:hover .star-label {
        color: #d4c5c8 !important; /* Reset màu khi hover container */
    }
    
    .rating-group .star-label:hover,
    .rating-group .star-label:hover ~ .star-label {
        color: #ffb400 !important;
        font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 48;
    }

    /* Giữ màu khi đã chọn (Checked logic xử lý bằng JS) */
</style>

<div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden bg-background-light dark:bg-background-dark text-[#181113] dark:text-white font-display">
    
    <!-- Main Content Area -->
    <main class="layout-container flex h-full grow flex-col">
        <div class="px-4 md:px-40 flex flex-1 justify-center py-8">
            <div class="layout-content-container flex flex-col max-w-[800px] flex-1">
                
                <!-- Page Heading -->
                <div class="flex flex-wrap justify-between gap-3 px-4 pb-4">
                    <div class="flex min-w-72 flex-col gap-3">
                        <h1 class="text-[#181113] dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]">Chia sẻ cảm nhận của bạn</h1>
                        <p class="text-[#8a606b] dark:text-[#ccb0b8] text-base font-normal leading-normal">
                            Cảm ơn bạn đã ghé thăm <strong>@Model.SpaName</strong>. Ý kiến của bạn giúp chúng tôi nâng cao chất lượng dịch vụ và mang đến trải nghiệm tuyệt vời hơn.
                        </p>
                    </div>
                </div>

                <!-- Form Card -->
                <form asp-controller="Review" asp-action="Submit" method="post" class="bg-white dark:bg-[#2f1b20] rounded-xl shadow-sm border border-[#f0e6e8] dark:border-[#3a2e32] overflow-hidden">
                    <input type="hidden" name="AppointmentId" value="@Model.AppointmentId" />

                    <!-- Service Selection -->
                    <div class="p-6 md:p-8 border-b border-[#f5f0f1] dark:border-[#3a2e32]">
                        <div class="flex flex-col gap-2">
                            <label class="text-[#181113] dark:text-white text-base font-bold leading-normal pb-1" for="service-select">Dịch vụ bạn đã sử dụng</label>
                            <div class="relative">
                                <select name="SelectedItemId" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#181113] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/20 border border-[#e6dbde] dark:border-[#4a3a3f] bg-white dark:bg-[#1a0d10] h-14 placeholder:text-[#8a606b] p-[15px] pr-10 text-base font-normal leading-normal appearance-none" id="service-select">
                                    <option value="" selected>Đánh giá chung cho cả lịch hẹn</option>
                                    @foreach (var item in Model.UsedServices)
                                    {
                                        <option value="@item.Id">@item.Name (@item.Price.ToString("N0")đ)</option>
                                    }
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-[#8a606b]">
                                    <span class="material-symbols-outlined">expand_more</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rating Section -->
                    <div class="p-6 md:p-8 border-b border-[#f5f0f1] dark:border-[#3a2e32] bg-[#fdfbfb] dark:bg-[#2a161b]">
                        <h2 class="text-[#181113] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] mb-4">Bạn đánh giá trải nghiệm này bao nhiêu sao?</h2>
                        
                        <div class="flex items-center gap-2 rating-group flex-row-reverse justify-end">
                            <!-- Input Rating 5 -->
                            <input type="radio" id="star5" name="Rating" value="5" class="hidden peer/5" checked />
                            <label for="star5" class="star-label group p-1 transition-transform hover:scale-110 cursor-pointer peer-checked/5:text-[#ffb400] text-[#d4c5c8]">
                                <span class="material-symbols-outlined text-4xl filled">star</span>
                            </label>

                            <!-- Input Rating 4 -->
                            <input type="radio" id="star4" name="Rating" value="4" class="hidden peer/4" />
                            <label for="star4" class="star-label group p-1 transition-transform hover:scale-110 cursor-pointer peer-checked/4:text-[#ffb400] peer-checked/5:text-[#ffb400] text-[#d4c5c8]">
                                <span class="material-symbols-outlined text-4xl filled">star</span>
                            </label>

                            <!-- Input Rating 3 -->
                            <input type="radio" id="star3" name="Rating" value="3" class="hidden peer/3" />
                            <label for="star3" class="star-label group p-1 transition-transform hover:scale-110 cursor-pointer peer-checked/3:text-[#ffb400] peer-checked/4:text-[#ffb400] peer-checked/5:text-[#ffb400] text-[#d4c5c8]">
                                <span class="material-symbols-outlined text-4xl filled">star</span>
                            </label>

                            <!-- Input Rating 2 -->
                            <input type="radio" id="star2" name="Rating" value="2" class="hidden peer/2" />
                            <label for="star2" class="star-label group p-1 transition-transform hover:scale-110 cursor-pointer peer-checked/2:text-[#ffb400] peer-checked/3:text-[#ffb400] peer-checked/4:text-[#ffb400] peer-checked/5:text-[#ffb400] text-[#d4c5c8]">
                                <span class="material-symbols-outlined text-4xl filled">star</span>
                            </label>

                            <!-- Input Rating 1 -->
                            <input type="radio" id="star1" name="Rating" value="1" class="hidden peer/1" />
                            <label for="star1" class="star-label group p-1 transition-transform hover:scale-110 cursor-pointer peer-checked/1:text-[#ffb400] peer-checked/2:text-[#ffb400] peer-checked/3:text-[#ffb400] peer-checked/4:text-[#ffb400] peer-checked/5:text-[#ffb400] text-[#d4c5c8]">
                                <span class="material-symbols-outlined text-4xl filled">star</span>
                            </label>
                        </div>
                        <span class="ml-2 text-[#8a606b] dark:text-[#ccb0b8] text-sm font-medium mt-2 block" id="rating-text">Tuyệt vời</span>
                    </div>

                    <!-- Text Feedback -->
                    <div class="p-6 md:p-8 pb-4">
                        <label class="text-[#181113] dark:text-white text-base font-bold leading-normal pb-2 block" for="feedback-content">Lời nhắn chi tiết</label>
                        <textarea name="Comment" required
                            class="flex w-full min-w-0 flex-1 resize-y overflow-hidden rounded-xl text-[#181113] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/20 border border-[#e6dbde] dark:border-[#4a3a3f] bg-white dark:bg-[#1a0d10] min-h-[160px] placeholder:text-[#8a606b] p-[15px] text-base font-normal leading-normal" 
                            id="feedback-content" 
                            placeholder="Hãy chia sẻ thêm về trải nghiệm của bạn (ví dụ: tay nghề nhân viên, không gian, vệ sinh)..."></textarea>
                    </div>

                    <!-- Image Upload (UI Only - Not connected to backend yet per Request) -->
                    <div class="px-6 md:px-8 pb-8">
                        <p class="text-[#181113] dark:text-white text-base font-bold leading-normal pb-2">Hình ảnh thực tế (Tùy chọn)</p>
                        <div class="border-2 border-dashed border-[#e6dbde] dark:border-[#4a3a3f] rounded-xl p-8 flex flex-col items-center justify-center bg-[#faf8f9] dark:bg-[#251418] cursor-pointer hover:bg-[#f5f0f1] dark:hover:bg-[#2d1a1f] transition-colors group">
                            <div class="bg-white dark:bg-[#3a2e32] p-3 rounded-full shadow-sm mb-3 group-hover:scale-110 transition-transform">
                                <span class="material-symbols-outlined text-primary text-2xl">add_photo_alternate</span>
                            </div>
                            <p class="text-[#181113] dark:text-white font-medium">Tải lên hình ảnh</p>
                            <p class="text-[#8a606b] dark:text-[#ccb0b8] text-sm mt-1">PNG, JPG lên đến 5MB</p>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="p-6 md:p-8 bg-[#fdfbfb] dark:bg-[#2a161b] border-t border-[#f5f0f1] dark:border-[#3a2e32] flex flex-col md:flex-row items-center justify-between gap-4">
                        <div class="flex items-center gap-2">
                            <input name="IsAnonymous" value="true" class="rounded border-[#e6dbde] text-primary focus:ring-primary bg-white dark:bg-[#1a0d10] dark:border-[#4a3a3f]" id="anonymous" type="checkbox"/>
                            <label class="text-[#181113] dark:text-white text-sm font-medium cursor-pointer select-none" for="anonymous">Gửi ẩn danh</label>
                        </div>
                        <div class="flex gap-3 w-full md:w-auto">
                            <a asp-controller="Profile" asp-action="History" class="flex-1 md:flex-none flex items-center justify-center min-w-[120px] h-12 px-6 rounded-xl border border-[#e6dbde] dark:border-[#4a3a3f] bg-white dark:bg-[#1a0d10] text-[#181113] dark:text-white font-bold text-sm hover:bg-gray-50 dark:hover:bg-[#251418] transition-colors">
                                Hủy bỏ
                            </a>
                            <button type="submit" class="flex-1 md:flex-none min-w-[160px] h-12 px-6 rounded-xl bg-primary text-white font-bold text-sm hover:bg-primary/90 shadow-lg shadow-primary/30 transition-all hover:translate-y-[-1px]">
                                Gửi phản hồi
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Footer Helper Text -->
                <div class="mt-8 text-center">
                    <p class="text-[#8a606b] dark:text-[#ccb0b8] text-sm">
                        Cần hỗ trợ? <a class="text-primary font-medium hover:underline" href="#">Liên hệ bộ phận chăm sóc khách hàng</a>
                    </p>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    // Script cập nhật text đánh giá
    const ratingInputs = document.querySelectorAll('input[name="Rating"]');
    const ratingText = document.getElementById('rating-text');
    const texts = {
        5: "Tuyệt vời",
        4: "Hài lòng",
        3: "Bình thường",
        2: "Không hài lòng",
        1: "Tệ"
    };

    ratingInputs.forEach(input => {
        input.addEventListener('change', function() {
            if (this.checked) {
                ratingText.textContent = texts[this.value];
            }
        });
    });
</script>